## MongoDB's $lookup Aggregator

1、一对多

先创建一张表\`countryCode\`

```
db.countryCode.insert([{code: 1}, {code: 20}, {code: 30}])
```

![](/assets/countryCode.png)

第二张表\`countryCodeLookup\`，这张表显示country的code和country的name 的对应关系

```
db.countryCodeLookup.insert([{code: 1, name: "United States"}, {code: 20, name: "Egypt"}, 
{code: 1, name: "Foobar"}, {code: 30, name: "Greece"}])
```

![](/assets/countryCodeLookup.png)

下面通过 $lookup 操作符连接两个集合，其中 $project 会过滤属性

```
db.countryCode.aggregate([
{ $lookup: {from: "countryCodeLookup", localField: "code", foreignField: "code", as: "countryName"} },
{ $project: {"code":1, "countryName.name":1, "_id":0} }
])
```

![](/assets/countryCodeLookupjoin.png)

$match 会查询连接后的表，显示符合条件的。

```
db.countryCode.aggregate([
{ $lookup: {from: "countryCodeLookup", localField: "code", foreignField: "code", as: "countryName"} },
{ $project: {"code":1, "countryName.name":1, "_id":0} },
{ $match:{"code":1.0}}
])
```

![](/assets/match.png)













